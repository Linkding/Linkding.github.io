<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>slack+hubot简易配置 | Linkding</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">slack+hubot简易配置</h1><a id="logo" href="/.">Linkding</a><p class="description">不是所有的鱼都生活在同一片海里</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 我</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">slack+hubot简易配置</h1><div class="post-meta">Aug 30, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/08/30/20160830-slack-hubot-base-install/" href="/2016/08/30/20160830-slack-hubot-base-install/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p><strong>slack</strong> 是现在非常流行的团队协作看板工具，支持多频道，多平台独立的沟通，而且有非常强大的接口，连接其他平台的应用，比如github，trello等。Hubot是一个开源的CoffScript机器人，它可以通过一写聊天工具实现对机器的远程命令操作。正如该项目在Github上骄傲的说：它帮助极大的帮助员工提升效率。而我感兴趣正是如此，边聊天边指挥机器人远程操作服务器这样的场景。今天来尝试部署一下。</p>
<h2 id="Hubot"><a href="#Hubot" class="headerlink" title="Hubot"></a>Hubot</h2><h4 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h4><p>hubot是node开发，需要先配置node.js环境。我使用的系统环境在centos6.5。参考<a href="https://nodejs.org/en/download/package-manager/#enterprise-linux-and-fedora" target="_blank" rel="external">node.js官网</a></p>
<p>运行下面操作，可以先装上node的集合套件命令npm</p>
<p>如果选择 Node.js v4:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl --silent --location https://rpm.nodesource.com/setup_4.x | bash -</div></pre></td></tr></table></figure>
<p>如果选择 Node.js v6（我选择最高版本安装）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl --silent --location https://rpm.nodesource.com/setup_6.x | bash -</div></pre></td></tr></table></figure>
<p>如果选择Node.js 0.10:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl --silent --location https://rpm.nodesource.com/setup | bash -</div></pre></td></tr></table></figure>
<p>然后运行, as root:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install nodejs</div></pre></td></tr></table></figure>
<p><code>注：以上安装方式适用用centos6.5以上版本，以下版本不支持</code></p>
<h4 id="安装hubot"><a href="#安装hubot" class="headerlink" title="安装hubot"></a>安装hubot</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g hubot coffee-script yo generator-hubot</div></pre></td></tr></table></figure>
<p>创建一个hubot的运行目录,并配置相关组的写权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir /hubot</div><div class="line">chmod g+rwx /root</div><div class="line">chmod g+rwx /hubot</div><div class="line">chmod -R g+rwx /root/.npm</div></pre></td></tr></table></figure></p>
<p>在工作目录部署hubot<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yo hubot</div></pre></td></tr></table></figure></p>
<p>安装过程中会问你安装什么样的<code>adapter</code>，手工输入<code>slack</code>。<br>缺省安装的<code>hubot</code>，会带上<code>heroku</code>和<code>redis</code>，如果用不到的话，比如我就手工输入<code>slack</code>：<br><img src="http://7xvj0k.com1.z0.glb.clouddn.com/QQ%E6%88%AA%E5%9B%BE20160830104335.png" alt=""></p>
<p>在<code>hubot</code>目录下的<code>external-scripts.json</code>文件中把有关<code>heroku</code>和<code>redis</code>的两行删掉就行了，否则老是会报几个警告。并且移除hubot-scripts.json，否则会报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv hubot-scripts.json hubot-scripts.json.bak</div></pre></td></tr></table></figure></p>
<p>好了，现在总算可以了。用一下看看吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./bin/hubot</div></pre></td></tr></table></figure>
<h2 id="连接slack和hubot"><a href="#连接slack和hubot" class="headerlink" title="连接slack和hubot"></a>连接slack和hubot</h2><p>前提是你要注册有slack，这里我们进入“Apps &amp; Integrations”,搜索“hubot”，然后add，并配置相关信息，会得到一个“API TAKEN”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HUBOT_SLACK_TOKEN=you taken ./bin/hubot --adapter slack</div></pre></td></tr></table></figure>
<p>这个命令会连接你的bot到slack，你可以在slack上和hubot进行对话了、尝试下slack的<code>#general</code>频道（hubot默认的使用，add它进来即可）与hubot使用些基本命令交互下看看，比如help。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rob_ding help   #(你在slack设置的robot名字) help</div></pre></td></tr></table></figure>
<h2 id="在slack指挥hubot操作脚本"><a href="#在slack指挥hubot操作脚本" class="headerlink" title="在slack指挥hubot操作脚本"></a>在slack指挥hubot操作脚本</h2><p>我们需要小机器人来执行一些<code>shell</code>脚本，所以我们需要安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm install hubot-script-shellcmd</div><div class="line">cp -R node_modules/hubot-script-shellcmd/bash ./</div></pre></td></tr></table></figure>
<p>增加一个<code>hubot-script-shellcmd</code>模块到<code>external-scripts.json</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &quot;hubot-catme&quot;,</div><div class="line">  &quot;hubot-diagnostics&quot;,</div><div class="line">  &quot;hubot-help&quot;,</div><div class="line">  &quot;hubot-google-images&quot;,</div><div class="line">  &quot;hubot-google-translate&quot;,</div><div class="line">  &quot;hubot-pugme&quot;,</div><div class="line">  &quot;hubot-maps&quot;,</div><div class="line">  &quot;hubot-rules&quot;,</div><div class="line">  &quot;hubot-script-shellcmd&quot;, #增加此模块，注意逗号</div><div class="line">  &quot;hubot-shipit&quot;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>这里面的<code>helloworld</code>就是个例子,我稍微改一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp helloworld 这里谁最美</div></pre></td></tr></table></figure></p>
<p>好了，现在你重启一下小机器人，在你的<code>slack</code>端对机器人说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rob_ding shellcmd 这里谁最美</div></pre></td></tr></table></figure>
<p>看看效果吧！<br><img src="http://7xvj0k.com1.z0.glb.clouddn.com/QQ%E6%88%AA%E5%9B%BE20160830105748.png" alt=""></p>
<p>原理就是如此，需要执行什么脚本，就看自己需求了。</p>
<h2 id="让hubot始终运行"><a href="#让hubot始终运行" class="headerlink" title="让hubot始终运行"></a>让hubot始终运行</h2><p>hubot需要独立运行才能和slack保持通信，这里我们使用screen命令，即使退出了ssh终端，它也可以独立运行不中断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">screen -dmS hubot #创建一个运行的独立窗口，命名为hubot</div><div class="line">screen -list  #查看创建的独立窗口列表</div><div class="line">screen -r hubot #进入hubot的窗口</div><div class="line">#运行hubot进程</div><div class="line">HUBOT_SLACK_TOKEN=you taken ./bin/hubot --adapter slack</div><div class="line"></div><div class="line">快捷键ctrl+a+d，退出当前的hubot窗口，回到原来窗口</div></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/08/30/20160830-slack-hubot-base-install/" data-id="cjmli9cva000druospnk0jaxd" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2016/10/24/20161022-huangshuyang-share/" class="pre">20161022 黄老师深圳线下分享备忘</a><a href="/2016/08/28/20160828-rhetoric-awareness/" class="next">修辞是对语言本真的还原</a></div><div id="disqus_thread"><script>var disqus_shortname = 'Linkding';
var disqus_identifier = '2016/08/30/20160830-slack-hubot-base-install/';
var disqus_title = 'slack+hubot简易配置';
var disqus_url = 'http://yoursite.com/2016/08/30/20160830-slack-hubot-base-install/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//Linkding.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据/">数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/耕读/">耕读</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/科幻概论/" style="font-size: 15px;">科幻概论</a> <a href="/tags/《家族的形式》/" style="font-size: 15px;">《家族的形式》</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/投资/" style="font-size: 15px;">投资</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/港股-pb/" style="font-size: 15px;">港股 pb</a> <a href="/tags/后记/" style="font-size: 15px;">后记</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/27/test/">test</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/09/20170809-how_different_between_append_and_html/">jQuery.append()和jQuery.html()的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/24/20161022-huangshuyang-share/">20161022 黄老师深圳线下分享备忘</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/30/20160830-slack-hubot-base-install/">slack+hubot简易配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/28/20160828-rhetoric-awareness/">修辞是对语言本真的还原</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/23/20160823-install-Hexo/">小记Jkeyll搬迁到Hxeo</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/17/20160817-rewrite-family-form/">改写《家族的形式》</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/02/20160724-Introduction-to-Science-Fiction-03/">【科幻概論2010】笔记之番外罗兰巴特</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/25/20160725-Introduction-to-Science-Fiction-02/">【國立清華大學‧科幻概論2010】第2講笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/24/20160724-Introduction-to-Science-Fiction-01/">【國立清華大學‧科幻概論2010】第1講笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//Linkding.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 朋友们</i></div><ul></ul><a href="https://gettingthingsdone.github.io/" title="海良" target="_blank">海良</a><ul></ul><a href="http://www.example2.com/" title="null" target="_blank"></a><ul></ul><a href="http://www.example3.com/" title="null" target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Linkding.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>